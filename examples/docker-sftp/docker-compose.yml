version: "2"

services:

  sftp:
    container_name: sftp
    image: atmoz/sftp
    volumes:
      - ./volume/share:/home/${SFTP_USER}/share
      - ./volume/hostkeys/ssh_host_ed25519_key:/etc/ssh/ssh_host_ed25519_key
      - ./volume/hostkeys/ssh_host_rsa_key:/etc/ssh/ssh_host_rsa_key
      - ./volume/keyring/sftp/id_rsa.pub:/home/${SFTP_USER}/.ssh/keys/id_rsa.pub:ro
    networks:
      stuxnet:
        ipv4_address: ${SFTP_ADDR}
        aliases:
          - sftp
    ports:
        - 22:22
    command: ${SFTP_USER}:${SFTP_PASS}:1001

  client:
    container_name: client
    build: client
    volumes:
      - ./client/volume/runner.sh:/root/runner.sh
      - ./client/volume/id_rsa:/root/.ssh/id_rsa
      - ./client/volume/id_rsa.pub:/root/.ssh/id_rsa.pub
    networks:
      stuxnet:
        ipv4_address: ${CLIENT_ADDR}
        aliases:
          - client
    depends_on:
      - sftp
    command: /bin/sh /root/runner.sh

networks:
  stuxnet:
    driver: bridge
    ipam:
      config:
        - subnet: "172.69.0.0/24"
          gateway: "172.69.0.254"
